generator client {
  provider = "prisma-client"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
}

enum ContentType {
  TEXT
  IMAGE
  VIDEO
  AUDIO
  FILE
}

model User {
  id            String    @id @default(uuid())
  userName      String
  email         String    @unique
  password      String
  avatar        String?
  refreshToken  String?
  emailVerified DateTime?
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  chats        ChatParticipant[]
  sentMessages Message[]
}

model Chat {
  id          String   @id @default(uuid())
  chatType    String
  groupName   String?
  groupAvatar String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  participants ChatParticipant[]
  messages     Message[]
}

model ChatParticipant {
  id          String    @id @default(uuid())
  userId      String
  chatId      String
  joinedAt    DateTime  @default(now())
  unreadCount Int       @default(0)
  lastReadAt  DateTime?

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)
  chat Chat @relation(fields: [chatId], references: [id], onDelete: Cascade)

  @@unique([userId, chatId])
}

model Message {
  id          String      @id @default(uuid())
  chatId      String
  senderId    String
  content     String
  contentType ContentType @default(TEXT)
  fileUrl     String?
  readAt      DateTime?
  createdAt   DateTime    @default(now())
  updatedAt   DateTime    @updatedAt

  chat   Chat @relation(fields: [chatId], references: [id], onDelete: Cascade)
  sender User @relation(fields: [senderId], references: [id], onDelete: Cascade)
}

model Token {
  id      String   @id @default(cuid())
  email   String
  token   String
  expires DateTime

  @@unique([email, token])
}
